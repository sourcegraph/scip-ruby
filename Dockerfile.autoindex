FROM --platform=linux/amd64 ruby:2.7.6-alpine3.16@sha256:b014cf3e792d7130daec772241a211c40be009fc7f00e2b728ffe26805649575

RUN apk add --no-cache bash wget make libstdc++ gcc g++ automake autoconf gcompat

RUN wget https://github.com/sourcegraph/scip-ruby/releases/download/scip-ruby-v0.3.0/scip-ruby-x86_64-linux -O /usr/bin/scip-ruby && chmod +x /usr/bin/scip-ruby

COPY scip_indexer/autoindex.sh /usr/bin/scip-ruby-autoindex

RUN chmod +x /usr/bin/scip-ruby-autoindex

CMD ["/bin/sh"]
